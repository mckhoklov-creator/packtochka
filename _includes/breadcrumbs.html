{% assign url_parts = page.url | split: '/' %}
{% assign last_part = '' %}
{% for part in url_parts %}
  {% unless part == '' %}
    {% assign last_part = part %}
  {% endunless %}
{% endfor %}

<nav class="breadcrumbs" aria-label="Хлебные крошки">
  <ol class="breadcrumbs__list">
    <li class="breadcrumbs__item"><a href="{{ '/' | relative_url }}">Главная</a></li>
    {% if page.collection == 'posts' %}
      <li class="breadcrumbs__item"><a href="{{ '/blog/' | relative_url }}">Блог</a></li>
      <li class="breadcrumbs__item" aria-current="page">{{ page.title | default: page.name }}</li>
    {% else %}
      {% assign accumulated_path = '' %}
      {% for part in url_parts %}
        {% unless part == '' %}
          {% assign accumulated_path = accumulated_path | append: '/' | append: part %}
          {% assign is_last = part == last_part %}
          {% assign item_url = accumulated_path | append: '/' %}
          {% if is_last %}
            <li class="breadcrumbs__item" aria-current="page">{{ page.title | default: page.name }}</li>
          {% else %}
            {% assign label = nil %}
            {% assign page_match = site.pages | where: "url", item_url | first %}
            {% unless page_match %}
              {% assign page_match = site.pages | where: "permalink", item_url | first %}
            {% endunless %}
            {% if page_match and page_match.title %}
              {% assign label = page_match.title %}
            {% endif %}
            {% unless label %}
              {% assign category = site.data.catalog_categories | where: "slug", part | first %}
              {% if category %}
                {% assign label = category.title %}
              {% endif %}
            {% endunless %}
            {% unless label %}
              {% assign label = part | replace: '-', ' ' %}
              {% assign label = label | replace: '  ', ' ' %}
              {% assign label = label | capitalize %}
            {% endunless %}
            <li class="breadcrumbs__item"><a href="{{ item_url | relative_url }}">{{ label }}</a></li>
          {% endif %}
        {% endunless %}
      {% endfor %}
    {% endif %}
  </ol>
</nav>

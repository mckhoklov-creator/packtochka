---
layout: default
---

{% comment %}
Подтягиваем картинку: сначала из front matter (page.images),
если нет — ищем запись товара в _data/products.yml по slug и берём её images[0].
{% endcomment %}
{% assign product_record = site.data.products | where: "slug", page.slug | first %}
{% assign photo_src = nil %}
{% if page.images and page.images.size > 0 %}
  {% assign photo_src = page.images[0] %}
{% elsif product_record and product_record.images and product_record.images.size > 0 %}
  {% assign photo_src = product_record.images[0] %}
{% endif %}

<nav aria-label="breadcrumb" style="margin:10px 0; font-size:.95rem;">
  <a href="{{ site.baseurl }}/">Главная</a> ›
  <a href="{{ site.baseurl }}/katalog/">Каталог</a> ›
  <a href="{{ site.baseurl }}/katalog/{{ page.category }}/">
    {% case page.category %}
      {% when "korobki" %}Коробки
      {% when "pakety" %}Пакеты
      {% when "skotch" %}Скотч
      {% when "plenka" %}Плёнка
      {% when "prochie" %}Прочее
      {% else %}Категория
    {% endcase %}
  </a> ›
  <span aria-current="page">{{ page.name }}</span>
</nav>

<article class="product" style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
  <div>
    {% if photo_src %}
      <img src="{{ site.baseurl }}{{ photo_src }}" alt="{{ page.name }}" style="width:100%;border-radius:10px;">
    {% endif %}
  </div>
  <div>
    <h1>{{ page.name }}</h1>
    <p style="color:#666">Артикул: {{ page.sku }}</p>
    <p style="font-size:1.2rem;color:#1a237e;font-weight:700">{{ page.price }} {{ page.unit }}</p>
    {% if page.min_qty %}<p>Минимальный заказ: {{ page.min_qty }}</p>{% endif %}
    <p>{{ page.short }}</p>
    <button class="btn btn-gradient add-to-cart"
            data-sku="{{ page.sku }}"
            data-name="{{ page.name }}"
            data-price="{{ page.price }}">Добавить в корзину</button>

    <div style="margin-top:20px;">
      <a href="{{ site.baseurl }}/katalog/{{ page.category }}/" style="margin-right:12px;">← Вернуться в категорию</a>
      <a href="{{ site.baseurl }}/katalog/">Каталог</a>
    </div>
  </div>
</article>

<section class="mt-5">
  <h2>С этим покупают</h2>
  <div class="grid">
    {% assign related = site.data.products | where_exp: "item", "item.category != page.category" %}
    {% assign related = related | sample: 4 %}
    {% for p in related %}
      <div class="card">
        <a href="{{ site.baseurl }}/katalog/{{ p.category }}/{{ p.slug }}/">
          <img src="{{ site.baseurl }}{{ p.images | first }}" alt="{{ p.name }}">
          <h3>{{ p.name }}</h3>
        </a>
        <p class="price">{{ p.price }} {{ p.unit }}</p>
        <button class="btn btn-gradient mt-2 add-to-cart" data-sku="{{ p.sku }}" data-name="{{ p.name }}" data-price="{{ p.price }}">В корзину</button>
      </div>
    {% endfor %}
  </div>
</section>
